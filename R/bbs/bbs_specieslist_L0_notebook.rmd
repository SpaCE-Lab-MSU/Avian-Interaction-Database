---
title: "BBS Species Updates Notebook"
format: pdf
---

## L0 BBS Species List Data

Pulls in raw BBS SpeciesList from 2024 release (up to 2023 BBS data), so it can be used in avian-meta-network (align with intxnpairs data before merging in L2)
PROJECT:        Avian Interaction Database & avian-meta-network
AUTHORS:        Phoebe Zarnetske, Patrick Bills
COLLABORATORS:  Vincent Miele, Stephane Dray, Emily Parker, Kelly Kapsar
DATA INPUT:     Imports L0 raw species list data from the USGS North American Breeding Bird Survey (SpeciesList.txt is updated every year).
without data

Check differences from years of BBS species 


to develop taxonomic harmonization workflow


#   you can find the URL by going to the USGS bbs page
#   https://www.sciencebase.gov/catalog/item/66d9ed16d34eef5af66d534b


```{r setup,message=FALSE, echo=FALSE}
# optionally 
# rm(ls())

require(here)
require(readr)
library(dplyr)
source(here::here("R/L0/L0_functions.R"))

file_paths <- get_file_config()

# renaming/assigning vars for consistency with previous code
google_drive_folder <- file.path(file_paths$SYNC_DATA_FOLDER, "species_completed")
L0_dir <- file_paths$L0


```

we've already downloaded the 2023 file and don't have the URL handy for re-download,
so read it in directly using the guessed encoding

```{r}
source(here::here("R/bbs/bbs_specieslist_L0_v2.R"))
bbs.splist.2023.file <- file.path(L0_dir,"bbs_splist_2022_L0.csv")
encoding.2023 <-readr::guess_encoding(bbs.splist.2023.file)
encoding.2023$encoding[1]

print(bbs.splist.2023.file)
```

not sure why this isn't UTF8 unless this file was downloaded on a windows computer
and saved here. 

read into a data frame and check it 
```{r}

bbs.splist.2023<-read.csv(bbs.splist.2023.file ,fileEncoding=encoding.2023$encoding[1])
print(nrow(bbs.splist.2023))
head(bbs.splist.2023)
```
Read using re-useable function that also 

```{r}

bbs.splist.2023 <- read_bbs_2023(bbs.splist.2023.file)
head(bbs.splist.2023)
```


download 2024 file (with 2023 data) if it's not downloaded already, read and 
alter columns for comparison

```{r}
bbs.splist.2024.file <- file.path(L0_dir,"BBS2024_SpeciesListL0.csv")
# this only downloads and modifies if we don't have one already
bbs.splist.2024 <- download_current_bbs_csv(bbs_csv_file_path = bbs.splist.2024.file)
head(bbs.splist.2024 )
```
## Compare sp list to find changed species

check names
```{r}
print('2023')
print(names(bbs.splist.2023))
print('2024')
print(names(bbs.splist.2024))

```

Compare
```{r}

diffs <- difference_bbs_species_list_2023_24(bbs.splist.2023,bbs.splist.2024 )
diffs
```



### Species differences & anomolies notes:

The current comparison lists these species as changing since last time:
 differing_values_diffEnglish_Common_Name


-  Northern Goshawk -> American Goshawk
- (unid. Red/Yellow Shafted) Northern Flicker -> (unid. Red / Yellow Shafted) Northern Flicker
- Pacific-slope Flycatcher -> (Pacific-slope Flycatcher) Western Flycatcher
- Cordilleran Flycatcher -> (Cordilleran Flycatcher) Western Flycatcher
- unid. Cordilleran / Pacific-slope Flycatcher -> (unid. Cordilleran / Pac-slope) Western Flycatcher
- Swinhoe¬ís White-eye -> Swinhoe‚Äôs White-eye
- Unid. Cassia Crossbill / Red Crossbill -> unid. Cassia Crossbill / Red Crossbill
- (unid. Myrtle/Audubon's) Yellow-rumped Warbler -> (unid. Myrtle / Audubon's) Yellow-rumped Warbler


The species re-assignment checking will occur in the next script: `bbs_specieslist_L1.R`

Then, if combining with bbs_obs data: `AvianInteractionData_L1.R`
